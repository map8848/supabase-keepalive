# 定时任务名称，可自定义
name: Supabase Keepalive

# 触发规则：每周一 00:00 UTC 执行（对应北京时间 8:00），同时支持手动触发
on:
  schedule:
    - cron: '0 0 * * *'  # 每周执行一次，足够防止休眠；如需更频繁，可改为 '0 0 * * *'（每天）
  workflow_dispatch:     # 手动触发开关

# 任务执行逻辑
jobs:
  ping-supabase:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          # 替换为你的 Supabase 项目 URL 和 anon key（必须改！）
          - url: "https://yptwhpcduynweqdsofmx.supabase.co"
            key: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlwdHdocGNkdXlud2VxZHNvZm14Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyMTQ1OTgsImV4cCI6MjA3OTc5MDU5OH0.IKcpjcrIYL4ENB7RwtrbJJN8M-ioH9Ajhp4GOX5j6sg"
          - url: "https://pwsaexmpdnyxwbvjecvr.supabase.co"
            key: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB3c2FleG1wZG55eHdidmplY3ZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3MDM3NzMsImV4cCI6MjA4MzI3OTc3M30.701aZJ8zu9dDgEOOQBwNMwR530riO_jlrcytdZARKsQ"
    steps:
      - name: Ping Project
        run: |
          RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" \
            -X GET "${{ matrix.url }}/rest/v1/" \
            -H "apikey: ${{ matrix.key }}" \
            -H "Authorization: Bearer ${{ matrix.key }}")
          
          # 输出请求结果，方便排查问题
          if [ "$RESPONSE" -eq 200 ] || [ "$RESPONSE" -eq 401 ]; then
            echo "✅ Supabase ping 成功，状态码: $RESPONSE"
          else
            echo "❌ Supabase ping 失败，状态码: $RESPONSE"
            exit 1
          fi
          
