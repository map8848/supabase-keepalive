# å®šæ—¶ä»»åŠ¡åç§°ï¼Œå¯è‡ªå®šä¹‰
name: Keep Supabase Projects Alive
# è§¦å‘è§„åˆ™ï¼šæ¯å‘¨ä¸€ 00:00 UTC æ‰§è¡Œï¼ˆå¯¹åº”åŒ—äº¬æ—¶é—´ 8:00ï¼‰ï¼ŒåŒæ—¶æ”¯æŒæ‰‹åŠ¨è§¦å‘
on:
  schedule:
    - cron: '0 0 * * *'  # æ¯å¤©æ‰§è¡Œä¸€æ¬¡ï¼Œè¶³å¤Ÿé˜²æ­¢ä¼‘çœ ï¼›æ¯å‘¨ä¸€å¯æ”¹ä¸º '0 0 * * 1'ï¼ˆæ¯å¤©ï¼‰
  workflow_dispatch:     # å…è®¸æ‰‹åŠ¨è§¦å‘
# ä»»åŠ¡æ‰§è¡Œé€»è¾‘
jobs:
  keep-alive:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        project: ["pwsaexmpdnyxwbvjecvr", "yptwhpcduynweqdsofmx"]
    steps:
      - name: Ping Supabase Project
        run: |
          url="https://${{ matrix.project }}.supabase.co/functions/v1/ping"
          echo "ğŸ“¡ Pinging $url..."
          
          for attempt in {1..3}; do
            response=$(curl -s -o /dev/null -w "%{http_code}" --max-time 10 "$url")
            if [ "$response" -eq 200 ]; then
              echo "âœ… Success for ${{ matrix.project }} (HTTP 200)"
              exit 0
            fi
            echo "âš ï¸ Attempt $attempt failed (HTTP $response), retrying in 2s..."
            sleep 2
          done
          
          echo "âŒ All attempts failed for ${{ matrix.project }} (last status: $response)"
          exit 1
